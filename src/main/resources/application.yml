spring:
  application:
    name: AiClassificator

  # Desabilita Config Server para desenvolvimento local
  cloud:
    config:
      enabled: false

# Configuracoes do servidor
server:
  port: 8080

# Configuracoes de seguranca
security:
  # API Key para autenticacao (definir via variavel de ambiente em producao)
  api-key: ${API_KEY:}
  # Admin Key para operacoes administrativas (rotacao de chaves)
  admin-key: ${ADMIN_KEY:}

# Configuracao do OpenAPI/Swagger
springdoc:
  api-docs:
    enabled: true
    path: /v3/api-docs
  swagger-ui:
    enabled: true
    path: /swagger-ui.html
    operations-sorter: method
    tags-sorter: alpha
  show-actuator: false

# Configuracoes de IA
ai:
  # Provider e modelo padrao quando nao especificado na requisicao
  default-provider: azure-openai
  default-model: gpt-4o-mini

  # Azure OpenAI (provider principal)
  azure-openai:
    enabled: true
    resource-name: ${AZURE_OPENAI_RESOURCE:caesb-openai}
    api-key: ${AZURE_OPENAI_API_KEY:}
    api-version: "2024-02-01"
    timeout: 30000
    default-temperature: 0.3
    default-max-tokens: 500
    deployments:
      gpt-4o-mini:
        deployment-name: gpt-4o-mini-deploy
        display-name: "GPT-4o Mini"
        description: "Modelo rapido e economico para tarefas gerais"
        enabled: true
      gpt-4o:
        deployment-name: gpt-4o-deploy
        display-name: "GPT-4o"
        description: "Modelo de alta qualidade para tarefas complexas"
        enabled: true
      gpt-4:
        deployment-name: gpt-4-deploy
        display-name: "GPT-4"
        description: "Modelo robusto e confiavel"
        enabled: false
      claude-3-sonnet:
        deployment-name: claude-3-sonnet-deploy
        display-name: "Claude 3 Sonnet"
        description: "Claude 3 Sonnet via Azure AI Foundry"
        enabled: false


  # Sanitizador
  sanitizer:
    body-max-length: 300
    body-min-length: 200
    sanitize-pii: true

  # Classificacao
  classification:
    confidence-threshold: 0.75
    fallback-queue: Service Desk (1ยบ Nivel)

  # Cache de idempotencia
  cache:
    ttl-minutes: 5
    max-size: 1000

# Configuracoes de Resilience4j
resilience4j:
  circuitbreaker:
    instances:
      azureopenai:
        registerHealthIndicator: true
        slidingWindowSize: 10
        permittedNumberOfCallsInHalfOpenState: 3
        slidingWindowType: COUNT_BASED
        minimumNumberOfCalls: 5
        waitDurationInOpenState: 30s
        failureRateThreshold: 50
        eventConsumerBufferSize: 10
        slowCallDurationThreshold: 10s
        slowCallRateThreshold: 100

  retry:
    instances:
      azureopenai:
        maxAttempts: 3
        waitDuration: 1s
        enableExponentialBackoff: true
        exponentialBackoffMultiplier: 2
        retryExceptions:
          - org.springframework.web.client.RestClientException
          - java.net.SocketTimeoutException
          - java.io.IOException

  ratelimiter:
    instances:
      azureopenai:
        limitForPeriod: 100
        limitRefreshPeriod: 1m
        timeoutDuration: 0

# Actuator - configuracao segura
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: when_authorized
      probes:
        enabled: true
  health:
    circuitbreakers:
      enabled: true

# Logging
logging:
  level:
    root: INFO
    com.caesb.AiClassificator: DEBUG
    io.github.resilience4j: INFO
